<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Heat Flow in Pipe – Fourier’s Law</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>

<style>
body { margin:0; font-family:Arial; background:#0f172a; color:#e5e7eb; }
header { background:#020617; padding:20px; text-align:center; }
section { padding:20px; max-width:1200px; margin:auto; }
.card { background:#020617; padding:20px; border-radius:10px; margin-bottom:20px; }
label { display:block; margin-top:10px; }
input, select {
    width:100%; padding:8px; margin-top:5px;
    background:#020617; color:white;
    border:1px solid #334155; border-radius:5px;
}
button {
    margin-top:15px; padding:12px; width:100%;
    background:#2563eb; border:none; color:white;
    font-size:16px; border-radius:6px; cursor:pointer;
}
.flex { display:flex; gap:20px; flex-wrap:wrap; }
#scene { width:100%; height:300px; }
canvas { background:white; border-radius:8px; }
pre { white-space:pre-wrap; }
</style>
</head>

<body>

<header>
<h1>Fourier’s Law – Heat Conduction in Pipe</h1>
</header>

<section class="flex">

<div class="card" style="flex:1">
<h2>Inputs</h2>

<label>Inner Radius</label>
<input id="r1" type="number">
<select id="r1Unit"><option value="m">m</option><option value="cm">cm</option></select>

<label>Thickness</label>
<input id="thick" type="number">
<select id="thickUnit"><option value="m">m</option><option value="cm">cm</option></select>

<label>Pipe Length (m)</label>
<input id="L" type="number">

<label>Inner Temperature (°C)</label>
<input id="T1" type="number">

<label>Outer Temperature (°C)</label>
<input id="T2" type="number">

<label>Thermal Conductivity (W/m·K)</label>
<input id="k" type="number">

<label>Time</label>
<input id="time" type="number">
<select id="timeUnit">
<option value="s">seconds</option>
<option value="min">minutes</option>
<option value="hr">hours</option>
</select>

<button onclick="calculate()">Calculate</button>
</div>

<div class="card" style="flex:1">
<h2>3D Pipe</h2>
<div id="scene"></div>

<h2>Temperature vs Radius</h2>
<canvas id="graph" width="420" height="260"></canvas>
</div>

</section>

<section class="card">
<h2>Results</h2>
<pre id="output"></pre>
</section>

<script>
/* ---------- THREE.JS SETUP ---------- */
let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(45, 1, 0.1, 100);
camera.position.set(0,2,4);

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(sceneDiv = document.getElementById("scene").clientWidth, 300);
sceneDiv.appendChild(renderer.domElement);

let controls = new THREE.OrbitControls(camera, renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,0.6));
let light = new THREE.DirectionalLight(0xffffff,0.8);
light.position.set(5,5,5);
scene.add(light);

let outerPipe, innerPipe;

function animate(){
    requestAnimationFrame(animate);
    renderer.render(scene,camera);
}
animate();

/* ---------- CALCULATION ---------- */
function calculate(){

    let r1 = parseFloat(document.getElementById("r1").value);
    let thick = parseFloat(document.getElementById("thick").value);
    let L = parseFloat(document.getElementById("L").value);
    let T1 = parseFloat(document.getElementById("T1").value);
    let T2 = parseFloat(document.getElementById("T2").value);
    let k = parseFloat(document.getElementById("k").value);
    let time = parseFloat(document.getElementById("time").value);

    if(document.getElementById("r1Unit").value==="cm") r1/=100;
    if(document.getElementById("thickUnit").value==="cm") thick/=100;
    if(document.getElementById("timeUnit").value==="min") time*=60;
    if(document.getElementById("timeUnit").value==="hr") time*=3600;

    let r2 = r1 + thick;

    let Q = (2*Math.PI*k*L*(T1-T2))/Math.log(r2/r1);
    let heat = Q*time;

    document.getElementById("output").textContent =
`Heat Flow Rate Q = ${Q.toFixed(3)} W
Total Heat Transfer = ${heat.toFixed(3)} J`;

    drawPipe(r1,r2);
    drawGraph(r1,r2,T1,T2);
}

/* ---------- PIPE ---------- */
function drawPipe(r1,r2){
    if(outerPipe) scene.remove(outerPipe);
    if(innerPipe) scene.remove(innerPipe);

    outerPipe = new THREE.Mesh(
        new THREE.CylinderGeometry(r2,r2,2,64,true),
        new THREE.MeshStandardMaterial({color:0x64748b,side:THREE.DoubleSide})
    );

    innerPipe = new THREE.Mesh(
        new THREE.CylinderGeometry(r1,r1,2.05,64,true),
        new THREE.MeshStandardMaterial({color:0x020617,side:THREE.DoubleSide})
    );

    scene.add(outerPipe);
    scene.add(innerPipe);
}

/* ---------- GRAPH ---------- */
function drawGraph(r1,r2,T1,T2){
    let ctx = document.getElementById("graph").getContext("2d");
    ctx.clearRect(0,0,420,260);

    ctx.strokeStyle="black";
    ctx.beginPath();
    ctx.moveTo(40,20); ctx.lineTo(40,220); ctx.lineTo(400,220);
    ctx.stroke();

    ctx.fillText("Distance from center (m)",120,250);
    ctx.save(); ctx.rotate(-Math.PI/2);
    ctx.fillText("Temperature (°C)",-170,15); ctx.restore();

    ctx.strokeStyle="red";
    ctx.beginPath();
    for(let i=0;i<=100;i++){
        let r=r1+(r2-r1)*i/100;
        let T=T1-(T1-T2)*Math.log(r/r1)/Math.log(r2/r1);
        let x=40+i*3.6;
        let y=220-(T-T2)/(T1-T2)*180;
        i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
    }
    ctx.stroke();
}
</script>

</body>
</html>
